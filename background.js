const websiteUninstall="https://productivity.rocks/tool/ai-optimizer/uninstallation/";function contextClick(e,t){var o=e["menuItemId"];"promptSelection"===o&&(chrome.storage.local.set({promptTime:Date.now(),promptCurrentText:!0,promptLastText:e.selectionText}),openTab("https://chat.openai.com/chat","right")),"promptPage"===o&&(chrome.scripting.executeScript({target:{tabId:t.id},func:()=>{chrome.storage.local.set({promptTime:Date.now(),promptCurrentText:!0,promptLastText:document.documentElement.innerText})}}),openTab("https://chat.openai.com/chat","right"))}function openTab(t,e="right"){"right"===e?chrome.tabs.query({active:!0,currentWindow:!0},e=>{chrome.tabs.create({url:t,index:e[0].index+1})}):"current"===e?chrome.tabs.query({active:!0,currentWindow:!0},e=>{chrome.tabs.update(e[0].id,{url:t})}):chrome.tabs.create({url:t})}chrome.omnibox.onInputChanged.addListener((e,t)=>{e?chrome.omnibox.setDefaultSuggestion({description:"New Chat: %s"}):chrome.omnibox.setDefaultSuggestion({description:"Input a prompt"})}),chrome.commands.onCommand.addListener(e=>{"open_chat"===e&&openTab("https://chat.openai.com/chat")}),chrome.tabs.onUpdated.addListener((e,t,o)=>{"complete"===t.status&&o.active&&o.url.includes("chat.openai.com")&&chrome.tabs.sendMessage(e,{text:"openChat"})}),chrome.omnibox.onInputEntered.addListener(e=>{e&&chrome.storage.local.set({promptTime:Date.now(),promptCurrentText:!0,promptLastText:e}),openTab("https://chat.openai.com/chat","current")}),chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"promptSelection",title:'ðŸ¤– GPT Prompt "%s"'.replace(/"([^"]{30})[^"]+"/,'"$1..."'),contexts:["selection"]}),chrome.contextMenus.create({id:"promptPage",title:"ðŸ¤– GPT Prompt Page",contexts:["page"]})}),chrome.contextMenus.onClicked.addListener(contextClick),chrome.runtime.onInstalled.addListener(e=>{var t;e.previousVersion&&e.reason&&(t=chrome.runtime.getManifest().version,e.previousVersion,chrome.storage.sync.set({currentVersion:t}),"install"!==e.reason)&&e.reason}),chrome.runtime.setUninstallURL(websiteUninstall);