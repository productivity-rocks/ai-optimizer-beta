const websiteUninstall="https://productivity.rocks/tool/ai-optimizer/uninstallation/";function contextClick(t,e){var o=t["menuItemId"];"promptSelection"===o&&(chrome.storage.local.set({promptTime:Date.now(),promptCurrentText:!0,promptLastText:t.selectionText}),openTab("https://chat.openai.com/chat","right")),"promptPage"===o&&(chrome.scripting.executeScript({target:{tabId:e.id},func:()=>{chrome.storage.local.set({promptTime:Date.now(),promptCurrentText:!0,promptLastText:document.documentElement.innerText})}}),openTab("https://chat.openai.com/chat","right"))}function openTab(e,t="right"){"right"===t?chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.create({url:e,index:t[0].index+1})}):"current"===t?chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.update(t[0].id,{url:e})}):chrome.tabs.create({url:e})}function openNewWindowSplitView(){chrome.windows.getCurrent(t=>{var e=t.width,o=t.height,r=Math.round(e/2),n=e-r;chrome.tabs.query({active:!0,currentWindow:!0},function(t){t=t[0].url;chrome.windows.create({url:t,left:0,top:0,width:r,height:o,type:"normal"},function(e){chrome.windows.create({url:"https://chat.openai.com/chat/",left:r,top:0,width:n,height:o,type:"normal"},function(t){chrome.windows.update(e.id,{state:"maximized"}),chrome.windows.update(t.id,{state:"maximized"})})})})})}function saveClearStorage(){chrome.storage.sync.get("promptHistory",function(t){t&&t.promptHistory&&0<t.promptHistory.length&&chrome.storage.local.set({promptHistory:t.promptHistory},function(){chrome.storage.sync.remove("promptHistory",()=>{chrome.storage.local.get("promptHistory",function(t){console.log("Value of promptHistory in local storage is now:",t.promptHistory)})})})})}chrome.runtime.onMessage.addListener((t,e,o)=>{"open_new_window_chat_split"===t.action&&openNewWindowSplitView()}),chrome.omnibox.onInputChanged.addListener((t,e)=>{t?chrome.omnibox.setDefaultSuggestion({description:"New Chat: %s"}):chrome.omnibox.setDefaultSuggestion({description:"Input a prompt"})}),chrome.commands.onCommand.addListener(t=>{"open_chat"===t&&openTab("https://chat.openai.com/chat")}),chrome.tabs.onUpdated.addListener((t,e,o)=>{"complete"===e.status&&o.active&&o.url.includes("chat.openai.com")&&chrome.tabs.sendMessage(t,{text:"openChat"})}),chrome.omnibox.onInputEntered.addListener(t=>{t&&chrome.storage.local.set({promptTime:Date.now(),promptCurrentText:!0,promptLastText:t}),openTab("https://chat.openai.com/chat","current")}),chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"promptSelection",title:'ðŸ¤– GPT Prompt "%s"'.replace(/"([^"]{30})[^"]+"/,'"$1..."'),contexts:["selection"]}),chrome.contextMenus.create({id:"promptPage",title:"ðŸ¤– GPT Prompt Page",contexts:["page"]})}),chrome.contextMenus.onClicked.addListener(contextClick),chrome.runtime.onInstalled.addListener(t=>{var e=chrome.runtime.getManifest().version;t.previousVersion;chrome.storage.sync.set({currentVersion:e}),t.reason,t.reason,saveClearStorage()}),chrome.runtime.setUninstallURL(websiteUninstall);